{
  "meta": {
    "schema_name": "insurance_santa_property_inspection",
    "schema_version": "1.0.0",
    "locale": "ru-RU",
    "currency": "RUB",
    "engine": {
      "expression_language": "simple-js",
      "expression_notes": {
        "helpers": [
          "includes(arrayOrString, value)",
          "anySelected(array)",
          "count(array)",
          "coalesce(a,b,...)"
        ],
        "context": {
          "answers": "Map<field_id, any>",
          "computed": "Map<computed_id, any>",
          "pricing": "Pricing accumulator state"
        }
      }
    }
  },
  "dictionaries": {
    "DICT_INSURANCE_OBJECTS": {
      "id": "DICT_INSURANCE_OBJECTS",
      "items": [
        { "id": "OBJ_SANTA", "label": "–î–µ–¥ –ú–æ—Ä–æ–∑" },
        { "id": "OBJ_SLED", "label": "–°–∞–Ω–∏" },
        { "id": "OBJ_BAG", "label": "–ú–µ—à–æ–∫ —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏" },
        { "id": "OBJ_REINDEER", "label": "–û–ª–µ–Ω–∏" },
        { "id": "OBJ_ELVES", "label": "–≠–ª—å—Ñ—ã" },
        { "id": "OBJ_PROD_BREAK", "label": "–ü–µ—Ä–µ—Ä—ã–≤ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" },
        { "id": "OBJ_TPL", "label": "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏" },
        { "id": "OBJ_ALL_RISKS", "label": "–û—Ç –≤—Å–µ—Ö —Ä–∏—Å–∫–æ–≤" }
      ]
    },
    "DICT_SLED_TYPES": {
      "id": "DICT_SLED_TYPES",
      "items": [
        { "id": "SLED_MANUAL", "label": "–° —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º", "meta": { "risk_note": "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ –∞–≤–∞—Ä–∏–∏/—É—â–µ—Ä–±–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º" } },
        { "id": "SLED_AUTOPILOT", "label": "–° –∞–≤—Ç–æ–ø–∏–ª–æ—Ç–æ–º" }
      ]
    },
    "DICT_BAG_TYPES": {
      "id": "DICT_BAG_TYPES",
      "items": [
        { "id": "BAG_FABRIC", "label": "–¢–∫–∞–Ω–µ–≤—ã–π", "meta": { "risk_note": "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ –¥—ã—Ä–∫–∏ –∏ —É—Ç–µ—Ä–∏ –ø–æ–¥–∞—Ä–∫–æ–≤" } },
        { "id": "BAG_ARMORED_THREAD", "label": "–ò–∑ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –Ω–∏—Ç–∏" }
      ]
    },
    "DICT_COMMON_FLAGS_PUNCH_CORP": {
      "id": "DICT_COMMON_FLAGS_PUNCH_CORP",
      "items": [
        { "id": "FLAG_PUNCH_TENDENCY", "label": "–ï—Å—Ç—å —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –ø—É–Ω—à—É" },
        { "id": "FLAG_CORP_DEC30", "label": "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ 30 –¥–µ–∫–∞–±—Ä—è" }
      ]
    },
    "DICT_PROD_BREAK_FLAGS": {
      "id": "DICT_PROD_BREAK_FLAGS",
      "items": [
        { "id": "PB_PUNCH_TENDENCY", "label": "–°–∫–ª–æ–Ω–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∫ –ø—É–Ω—à—É" },
        { "id": "PB_CORP_DEC30", "label": "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ 30 –¥–µ–∫–∞–±—Ä—è" },
        { "id": "PB_ILLEGAL_ELVES", "label": "–ù–∞–ª–∏—á–∏–µ —ç–ª—å—Ñ–æ–≤ –Ω–µ–ª–µ–≥–∞–ª–æ–≤" }
      ]
    },
    "DICT_TPL_PARKING": {
      "id": "DICT_TPL_PARKING",
      "items": [
        { "id": "PARK_ROOFS", "label": "–ö—Ä—ã—à–∏ –¥–æ–º–æ–≤", "meta": { "tariff": "STANDARD" } },
        { "id": "PARK_YARDS", "label": "–î–≤–æ—Ä—ã", "meta": { "tariff": "STANDARD" } },
        { "id": "PARK_BALCONIES", "label": "–ë–∞–ª–∫–æ–Ω—ã", "meta": { "tariff": "STANDARD" } },
        { "id": "PARK_WHEREVER", "label": "–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—Å—è", "meta": { "tariff": "INCREASED", "risk_note": "–ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫" } }
      ]
    },
    "DICT_RISK_CATEGORIES": {
      "id": "DICT_RISK_CATEGORIES",
      "items": [
        { "id": "RC_SLED", "label": "–°–∞–Ω–∏", "object_gate": "OBJ_SLED" },
        { "id": "RC_REINDEER", "label": "–û–ª–µ–Ω–∏", "object_gate": "OBJ_REINDEER" },
        { "id": "RC_BAG", "label": "–ú–µ—à–æ–∫ —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏", "object_gate": "OBJ_BAG" },
        { "id": "RC_ELVES", "label": "–≠–ª—å—Ñ—ã", "object_gate": "OBJ_ELVES" },
        { "id": "RC_PROD_BREAK", "label": "–ü–µ—Ä–µ—Ä—ã–≤ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ", "object_gate": "OBJ_PROD_BREAK" },
        { "id": "RC_TPL", "label": "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏", "object_gate": "OBJ_TPL" },
        { "id": "RC_FORCE_MAJEURE", "label": "–§–æ—Ä—Å-–º–∞–∂–æ—Ä—ã", "object_gate": null }
      ]
    },
    "DICT_RISKS": {
      "id": "DICT_RISKS",
      "items": [
        { "id": "R_SLED_HARD_LANDING_BREAK", "category_id": "RC_SLED", "label": "–ü–æ–ª–æ–º–∫–∞ –ø—Ä–∏ –∂—ë—Å—Ç–∫–æ–π –ø–æ—Å–∞–¥–∫–µ", "weight": 1 },
        { "id": "R_SLED_FROZEN_TO_ROOF", "category_id": "RC_SLED", "label": "–ü—Ä–∏–º–µ—Ä–∑–∞–Ω–∏–µ –∫ –∫—Ä—ã—à–µ", "weight": 1 },
        { "id": "R_SLED_BAD_PARK_DAMAGE", "category_id": "RC_SLED", "label": "–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–∞—Ä–∫–æ–≤–∫–µ", "weight": 1 },
        { "id": "R_SLED_NAV_ISSUES", "category_id": "RC_SLED", "label": "–ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π", "weight": 1 },

        { "id": "R_REINDEER_OVERWORK", "category_id": "RC_REINDEER", "label": "–ü–µ—Ä–µ—É—Ç–æ–º–ª–µ–Ω–∏–µ", "weight": 1 },
        { "id": "R_REINDEER_LOST", "category_id": "RC_REINDEER", "label": "–ü–æ—Ç–µ—Ä—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏", "weight": 1 },
        { "id": "R_REINDEER_BITE_COLLEAGUE", "category_id": "RC_REINDEER", "label": "–£–∫—É—Å –∫–æ–ª–ª–µ–≥–∏", "weight": 1 },
        { "id": "R_REINDEER_VACATION_AWOL", "category_id": "RC_REINDEER", "label": "–°–∞–º–æ–≤–æ–ª—å–Ω—ã–π —É—Ö–æ–¥ –≤ –æ—Ç–ø—É—Å–∫", "weight": 1 },

        { "id": "R_BAG_LOST_ALL", "category_id": "RC_BAG", "label": "–£—Ç–µ—Ä—è –≤—Å–µ–≥–æ –º–µ—à–∫–∞", "weight": 3 },
        { "id": "R_BAG_DEFECT_UP_TO_30", "category_id": "RC_BAG", "label": "–ë—Ä–∞–∫ –¥–æ 30% –ø–æ–¥–∞—Ä–∫–æ–≤", "weight": 2 },
        { "id": "R_BAG_DEFECT_UP_TO_10", "category_id": "RC_BAG", "label": "–ë—Ä–∞–∫ –¥–æ 10% –ø–æ–¥–∞—Ä–∫–æ–≤", "weight": 1 },

        { "id": "R_ELVES_INJURY_PACKING", "category_id": "RC_ELVES", "label": "–¢—Ä–∞–≤–º–∞ –ø—Ä–∏ —É–ø–∞–∫–æ–≤–∫–µ –ø–æ–¥–∞—Ä–∫–æ–≤", "weight": 1 },
        { "id": "R_ELVES_MIGRAINE", "category_id": "RC_ELVES", "label": "–ú–∏–≥—Ä–µ–Ω—å (–ø–µ—Ä–µ–ø–∏–ª –ø—É–Ω—à –Ω–∞–∫–∞–Ω—É–Ω–µ)", "weight": 1 },
        { "id": "R_ELVES_MASS_FIGHT", "category_id": "RC_ELVES", "label": "–ú–∞—Å—Å–æ–≤–∞—è –¥—Ä–∞–∫–∞", "weight": 1 },
        { "id": "R_ELVES_BURNOUT_DEC25", "category_id": "RC_ELVES", "label": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ –∫ 25 –¥–µ–∫–∞–±—Ä—è", "weight": 1 },

        { "id": "R_PB_KEY_ELF_NO_SHOW", "category_id": "RC_PROD_BREAK", "label": "–ö–ª—é—á–µ–≤–æ–π —ç–ª—å—Ñ –Ω–µ –≤—ã—à–µ–ª –≤ —Å–º–µ–Ω—É (—É—à–µ–ª –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—É)", "weight": 1 },
        { "id": "R_PB_OVERSLEPT", "category_id": "RC_PROD_BREAK", "label": "–≠–ª—å—Ñ—ã –ø—Ä–æ—Å–ø–∞–ª–∏ —Å–º–µ–Ω—É (–∫–∞—Ä–∞–æ–∫–µ –¥–æ —É—Ç—Ä–∞)", "weight": 1 },
        { "id": "R_PB_STRIKE_REMOTE", "category_id": "RC_PROD_BREAK", "label": "–ó–∞–±–∞—Å—Ç–æ–≤–∫–∞ —ç–ª—å—Ñ–æ–≤ –∑–∞ –ø—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª—ë–Ω–∫—É", "weight": 1 },
        { "id": "R_PB_POWER_OFF", "category_id": "RC_PROD_BREAK", "label": "–í—ã—Ä—É–±–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ (–ª–∏–Ω–∏—è —É–ø–∞–∫–æ–≤–∫–∏ –≤—Å—Ç–∞–ª–∞)", "weight": 1 },
        { "id": "R_PB_MIGRATION_RAID", "category_id": "RC_PROD_BREAK", "label": "–û–±–ª–∞–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–ª—É–∂–±—ã", "weight": 1 },

        { "id": "R_TPL_ROOF_DAMAGE", "category_id": "RC_TPL", "label": "–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∫—Ä—ã—à–∏", "weight": 1 },
        { "id": "R_TPL_BALCONY_SCRATCH", "category_id": "RC_TPL", "label": "–ü–æ—Ü–∞—Ä–∞–ø–∞–Ω–Ω—ã–π –±–∞–ª–∫–æ–Ω", "weight": 1 },
        { "id": "R_TPL_ANTENNA_BROKEN", "category_id": "RC_TPL", "label": "–°–ª–æ–º–∞–Ω–Ω–∞—è –∞–Ω—Ç–µ–Ω–Ω–∞", "weight": 1 },
        { "id": "R_TPL_NEIGHBORS_SCARED", "category_id": "RC_TPL", "label": "–ò—Å–ø—É–≥–∞–Ω–Ω—ã–µ —Å–æ—Å–µ–¥–∏", "weight": 1 },
        { "id": "R_TPL_CHIMNEY_LEAK", "category_id": "RC_TPL", "label": "–ü—Ä–æ—Ç–µ—á–∫–∞ –¥—ã–º–æ—Ö–æ–¥–∞", "weight": 1 },

        { "id": "R_FM_CAT_ATTACK", "category_id": "RC_FORCE_MAJEURE", "label": "–ù–∞–ø–∞–¥–µ–Ω–∏–µ –∫–æ—Ç–∞", "weight": 1 },
        { "id": "R_FM_SOCIAL_PHOTO_REPUTATION", "category_id": "RC_FORCE_MAJEURE", "label": "–§–æ—Ç–æ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö (—Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫)", "weight": 1 },
        { "id": "R_FM_GIFTS_MIXED", "category_id": "RC_FORCE_MAJEURE", "label": "–ü–æ–¥–∞—Ä–∫–∏ –ø–µ—Ä–µ–ø—É—Ç–∞–ª–∏", "weight": 1 },
        { "id": "R_FM_HIRE_FREELANCE_ELVES", "category_id": "RC_FORCE_MAJEURE", "label": "–°—Ä–æ—á–Ω—ã–π –Ω–∞–π–º —Ñ—Ä–∏–ª–∞–Ω—Å-—ç–ª—å—Ñ–æ–≤", "weight": 1 }
      ]
    },
    "DICT_PAYMENT_METHODS": {
      "id": "DICT_PAYMENT_METHODS",
      "items": [
        { "id": "PAY_GOLD", "label": "–ó–æ–ª–æ—Ç–æ–º" },
        { "id": "PAY_GIFTS", "label": "–ü–æ–¥–∞—Ä–∫–∞–º–∏" },
        { "id": "PAY_CASH", "label": "–ù–∞–ª–∏—á–Ω—ã–º–∏" },
        { "id": "PAY_CARD", "label": "–ö–∞—Ä—Ç–æ–π" }
      ]
    }
  },
  "data_schema": {
    "tables": [
      {
        "table": "policy",
        "pk": ["policy_id"],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "created_at", "type": "timestamp", "nullable": false },
          { "name": "insured_sum", "type": "int", "nullable": true },
          { "name": "deductible", "type": "int", "nullable": true },
          { "name": "coverage_limit", "type": "int", "nullable": true },
          { "name": "premium_total", "type": "int", "nullable": true },
          { "name": "tariff_total", "type": "decimal", "nullable": true },
          { "name": "status", "type": "string", "nullable": false, "default": "DRAFT" }
        ]
      },
      {
        "table": "policy_object",
        "pk": ["policy_id", "object_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "object_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "santa_details",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "age", "type": "int", "nullable": true },
          { "name": "weight_kg", "type": "int", "nullable": true },
          { "name": "waist_cm", "type": "int", "nullable": true },
          { "name": "cold_risk_level", "type": "string", "nullable": true },
          { "name": "chimney_stuck_risk", "type": "string", "nullable": true }
        ]
      },
      {
        "table": "sled_details",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "sled_type_id", "type": "string", "nullable": true }
        ]
      },
      {
        "table": "bag_details",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "bag_type_id", "type": "string", "nullable": true }
        ]
      },
      {
        "table": "reindeer_details",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "reindeer_count", "type": "int", "nullable": true }
        ]
      },
      {
        "table": "reindeer_flag",
        "pk": ["policy_id", "flag_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "flag_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "elves_details",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "elves_count", "type": "int", "nullable": true }
        ]
      },
      {
        "table": "elves_flag",
        "pk": ["policy_id", "flag_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "flag_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "prod_break_flag",
        "pk": ["policy_id", "flag_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "flag_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "tpl_parking",
        "pk": ["policy_id", "parking_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "parking_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "policy_risk",
        "pk": ["policy_id", "risk_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "risk_id", "type": "string", "nullable": false }
        ]
      },
      {
        "table": "policyholder",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "full_name", "type": "string", "nullable": true },
          { "name": "phone", "type": "string", "nullable": true },
          { "name": "email", "type": "string", "nullable": true }
        ]
      },
      {
        "table": "payment",
        "pk": ["policy_id"],
        "fk": [{ "columns": ["policy_id"], "ref_table": "policy", "ref_columns": ["policy_id"] }],
        "columns": [
          { "name": "policy_id", "type": "uuid", "nullable": false },
          { "name": "payment_method_id", "type": "string", "nullable": true },
          { "name": "payment_status", "type": "string", "nullable": false, "default": "NOT_PAID" }
        ]
      }
    ]
  },
  "inventory": {
    "screens": [
      { "screen_id": "SCR_01_CONDITIONS", "title": "–£—Å–ª–æ–≤–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è", "order": 1 },
      { "screen_id": "SCR_03_RISKS", "title": "–†–∏—Å–∫–∏", "order": 2 },
      { "screen_id": "SCR_04_CALC", "title": "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", "order": 3 },
      { "screen_id": "SCR_05_CONTACTS", "title": "–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "order": 4 },
      { "screen_id": "SCR_06_PAYMENT", "title": "–û–ø–ª–∞—Ç–∞", "order": 5 }
    ],
    "fields": [
      {
        "field_id": "FLD_OBJECTS_SELECTED",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_01",
        "label": "–û–±—ä–µ–∫—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è",
        "component": "checkbox_group",
        "data_type": "string[]",
        "dictionary_id": "DICT_INSURANCE_OBJECTS",
        "required": true,
        "storage": { "table": "policy_object", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "object_id" } }
      },

      {
        "field_id": "FLD_SANTA_AGE",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–í–æ–∑—Ä–∞—Å—Ç",
        "component": "number",
        "data_type": "int",
        "required": false,
        "constraints": { "min": 0, "max": 130 },
        "storage": { "table": "santa_details", "column": "age" }
      },
      {
        "field_id": "FLD_SANTA_WEIGHT",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–í–µ—Å (–∫–≥)",
        "component": "number",
        "data_type": "int",
        "required": false,
        "constraints": { "min": 0, "max": 400 },
        "storage": { "table": "santa_details", "column": "weight_kg" }
      },
      {
        "field_id": "FLD_SANTA_WAIST",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–û–∫—Ä—É–∂–Ω–æ—Å—Ç—å —Ç–∞–ª–∏–∏ (—Å–º)",
        "component": "number",
        "data_type": "int",
        "required": false,
        "constraints": { "min": 0, "max": 300 },
        "storage": { "table": "santa_details", "column": "waist_cm" }
      },

      {
        "field_id": "FLD_SLED_TYPE",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–¢–∏–ø —Å–∞–Ω–µ–π",
        "component": "select",
        "data_type": "string",
        "dictionary_id": "DICT_SLED_TYPES",
        "required": false,
        "storage": { "table": "sled_details", "column": "sled_type_id" }
      },

      {
        "field_id": "FLD_BAG_TYPE",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–¢–∏–ø –º–µ—à–∫–∞",
        "component": "select",
        "data_type": "string",
        "dictionary_id": "DICT_BAG_TYPES",
        "required": false,
        "storage": { "table": "bag_details", "column": "bag_type_id" }
      },

      {
        "field_id": "FLD_REINDEER_COUNT",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ª–µ–Ω–µ–π",
        "component": "slider",
        "data_type": "int",
        "required": false,
        "constraints": { "min": 1, "max": 12, "step": 1 },
        "storage": { "table": "reindeer_details", "column": "reindeer_count" }
      },
      {
        "field_id": "FLD_REINDEER_FLAGS",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–î–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã",
        "component": "checkbox_group",
        "data_type": "string[]",
        "dictionary_id": "DICT_COMMON_FLAGS_PUNCH_CORP",
        "required": false,
        "storage": { "table": "reindeer_flag", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "flag_id" } }
      },

      {
        "field_id": "FLD_ELVES_COUNT",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª—å—Ñ–æ–≤",
        "component": "slider",
        "data_type": "int",
        "required": false,
        "constraints": { "min": 0, "max": 500, "step": 1 },
        "storage": { "table": "elves_details", "column": "elves_count" }
      },
      {
        "field_id": "FLD_ELVES_FLAGS",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–î–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã",
        "component": "checkbox_group",
        "data_type": "string[]",
        "dictionary_id": "DICT_COMMON_FLAGS_PUNCH_CORP",
        "required": false,
        "storage": { "table": "elves_flag", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "flag_id" } }
      },

      {
        "field_id": "FLD_PROD_BREAK_FLAGS",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ—Ä—ã–≤–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "component": "checkbox_group",
        "data_type": "string[]",
        "dictionary_id": "DICT_PROD_BREAK_FLAGS",
        "required": false,
        "storage": { "table": "prod_break_flag", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "flag_id" } }
      },

      {
        "field_id": "FLD_TPL_PARKING",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_02",
        "label": "–ü–∞—Ä–∫–æ–≤–∫–∞ —Å–∞–Ω–µ–π",
        "component": "checkbox_group",
        "data_type": "string[]",
        "dictionary_id": "DICT_TPL_PARKING",
        "required": false,
        "storage": { "table": "tpl_parking", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "parking_id" } }
      },

      {
        "field_id": "FLD_INSURED_SUM",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_03",
        "label": "–°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å—É–º–º–∞",
        "component": "slider",
        "data_type": "int",
        "required": true,
        "constraints": { "min": 500000, "max": 10000000, "step": 10000 },
        "storage": { "table": "policy", "column": "insured_sum" }
      },
      {
        "field_id": "FLD_DEDUCTIBLE",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_03",
        "label": "–§—Ä–∞–Ω—à–∏–∑–∞",
        "component": "slider",
        "data_type": "int",
        "required": true,
        "constraints": { "min": 0, "max": 500000, "step": 10000 },
        "storage": { "table": "policy", "column": "deductible" }
      },
      {
        "field_id": "FLD_COVERAGE_LIMIT",
        "screen_id": "SCR_01_CONDITIONS",
        "step": "STEP_03",
        "label": "–õ–∏–º–∏—Ç –ø–æ–∫—Ä—ã—Ç–∏—è",
        "component": "slider",
        "data_type": "int",
        "required": true,
        "constraints": { "min": 500000, "max": 10000000, "step": 10000 },
        "storage": { "table": "policy", "column": "coverage_limit" }
      },

      {
        "field_id": "FLD_RISKS_SLED",
        "screen_id": "SCR_03_RISKS",
        "label": "üõ∑ –°–∞–Ω–∏",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_SLED" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_REINDEER",
        "screen_id": "SCR_03_RISKS",
        "label": "ü¶å –û–ª–µ–Ω–∏",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_REINDEER" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_BAG",
        "screen_id": "SCR_03_RISKS",
        "label": "–ú–µ—à–æ–∫ —Å –ø–æ–¥–∞—Ä–∫–∞–º–∏",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_BAG" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_ELVES",
        "screen_id": "SCR_03_RISKS",
        "label": "üßù –≠–ª—å—Ñ—ã",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_ELVES" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_PROD_BREAK",
        "screen_id": "SCR_03_RISKS",
        "label": "üè≠ –ü–µ—Ä–µ—Ä—ã–≤ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_PROD_BREAK" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_TPL",
        "screen_id": "SCR_03_RISKS",
        "label": "üè† –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_TPL" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },
      {
        "field_id": "FLD_RISKS_FORCE_MAJEURE",
        "screen_id": "SCR_03_RISKS",
        "label": "üê± –§–æ—Ä—Å-–º–∞–∂–æ—Ä—ã",
        "component": "card_multiselect",
        "data_type": "string[]",
        "dictionary_id": "DICT_RISKS",
        "dictionary_filter": { "by": "category_id", "equals": "RC_FORCE_MAJEURE" },
        "required": false,
        "storage": { "table": "policy_risk", "mode": "link_table", "columns": { "policy_id": "policy.policy_id", "value": "risk_id" } }
      },

      {
        "field_id": "FLD_PREMIUM_TOTAL",
        "screen_id": "SCR_04_CALC",
        "label": "–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∞—è –ø—Ä–µ–º–∏—è",
        "component": "money_readonly",
        "data_type": "int",
        "required": false,
        "read_only": true,
        "storage": { "table": "policy", "column": "premium_total" }
      },
      {
        "field_id": "FLD_TARIFF_TOTAL",
        "screen_id": "SCR_04_CALC",
        "label": "–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Ç–∞—Ä–∏—Ñ",
        "component": "number_readonly",
        "data_type": "decimal",
        "required": false,
        "read_only": true,
        "storage": { "table": "policy", "column": "tariff_total" }
      },
      {
        "field_id": "FLD_TARIFF_BREAKDOWN",
        "screen_id": "SCR_04_CALC",
        "label": "–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞",
        "component": "json_readonly",
        "data_type": "object",
        "required": false,
        "read_only": true,
        "storage": { "table": "policy", "column": null }
      },

      {
        "field_id": "FLD_POLICYHOLDER_NAME",
        "screen_id": "SCR_05_CONTACTS",
        "label": "–§–ò–û —Å—Ç—Ä–∞—Ö–æ–≤–∞—Ç–µ–ª—è",
        "component": "text",
        "data_type": "string",
        "required": true,
        "constraints": { "min_length": 3, "max_length": 200 },
        "storage": { "table": "policyholder", "column": "full_name" }
      },
      {
        "field_id": "FLD_POLICYHOLDER_PHONE",
        "screen_id": "SCR_05_CONTACTS",
        "label": "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
        "component": "phone",
        "data_type": "string",
        "required": true,
        "storage": { "table": "policyholder", "column": "phone" }
      },
      {
        "field_id": "FLD_POLICYHOLDER_EMAIL",
        "screen_id": "SCR_05_CONTACTS",
        "label": "–≠–ª. –ø–æ—á—Ç–∞",
        "component": "email",
        "data_type": "string",
        "required": true,
        "storage": { "table": "policyholder", "column": "email" }
      },

      {
        "field_id": "FLD_PAYMENT_METHOD",
        "screen_id": "SCR_06_PAYMENT",
        "label": "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã",
        "component": "select",
        "data_type": "string",
        "required": true,
        "dictionary_id": "DICT_PAYMENT_METHODS",
        "storage": { "table": "payment", "column": "payment_method_id" }
      },
      {
        "field_id": "FLD_PAYMENT_STATUS",
        "screen_id": "SCR_06_PAYMENT",
        "label": "–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã",
        "component": "text_readonly",
        "data_type": "string",
        "required": false,
        "read_only": true,
        "storage": { "table": "payment", "column": "payment_status" }
      }
    ],
    "actions": [
      {
        "action_id": "ACT_PAY",
        "screen_id": "SCR_06_PAYMENT",
        "label": "–û–ø–ª–∞—Ç–∏—Ç—å",
        "component": "button",
        "enabled_when": "answers.FLD_PAYMENT_METHOD != null",
        "effects": [
          { "type": "set_value", "target_field_id": "FLD_PAYMENT_STATUS", "value_expr": "'PAID'" },
          { "type": "set_value", "target_table": "policy", "target_column": "status", "value_expr": "'PAID'" }
        ],
        "ui_effects": [
          { "type": "toast", "message": "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞" },
          { "type": "navigate", "target": "NEXT_SCREEN" }
        ]
      }
    ]
  },
  "computed": [
    {
      "computed_id": "CMP_SANTA_COLD_RISK_LEVEL",
      "label": "–†–∏—Å–∫ –ø—Ä–æ—Å—Ç—É–¥–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π",
      "data_type": "string",
      "expr": "answers.FLD_SANTA_AGE != null && answers.FLD_SANTA_AGE > 75 ? 'HIGH' : 'NORMAL'",
      "persist_to": { "table": "santa_details", "column": "cold_risk_level" }
    },
    {
      "computed_id": "CMP_SANTA_CHIMNEY_STUCK_RISK",
      "label": "–†–∏—Å–∫ –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏—è –≤ –¥—ã–º–æ—Ö–æ–¥–µ",
      "data_type": "string",
      "expr": "answers.FLD_SANTA_WEIGHT != null && answers.FLD_SANTA_WAIST != null && answers.FLD_SANTA_WEIGHT > 120 && answers.FLD_SANTA_WAIST > 150 ? 'HIGH' : 'NORMAL'",
      "persist_to": { "table": "santa_details", "column": "chimney_stuck_risk" }
    },
    {
      "computed_id": "CMP_ANY_REINDEER_FLAGS",
      "label": "–ï—Å—Ç—å –ø–æ–≤—ã—à–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –ø–æ –æ–ª–µ–Ω—è–º",
      "data_type": "boolean",
      "expr": "anySelected(coalesce(answers.FLD_REINDEER_FLAGS, []))"
    },
    {
      "computed_id": "CMP_ANY_ELVES_FLAGS",
      "label": "–ï—Å—Ç—å –ø–æ–≤—ã—à–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –ø–æ —ç–ª—å—Ñ–∞–º",
      "data_type": "boolean",
      "expr": "anySelected(coalesce(answers.FLD_ELVES_FLAGS, []))"
    },
    {
      "computed_id": "CMP_ANY_PROD_BREAK_FLAGS",
      "label": "–ï—Å—Ç—å –ø–æ–≤—ã—à–∞—é—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –ø–æ –ø–µ—Ä–µ—Ä—ã–≤—É –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ",
      "data_type": "boolean",
      "expr": "anySelected(coalesce(answers.FLD_PROD_BREAK_FLAGS, []))"
    },
    {
      "computed_id": "CMP_TPL_WHEREVER_SELECTED",
      "label": "–í—ã–±—Ä–∞–Ω–∞ –ø–∞—Ä–∫–æ–≤–∫–∞ '–≥–¥–µ –ø–æ–ª—É—á–∏—Ç—Å—è'",
      "data_type": "boolean",
      "expr": "includes(coalesce(answers.FLD_TPL_PARKING, []), 'PARK_WHEREVER')"
    }
  ],
  "pricing": {
    "parameters": [
      { "key": "BASE_RATE", "type": "decimal", "default": 0.015, "description": "–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (–¥–æ–ª—è –æ—Ç —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Å—É–º–º—ã –¥–æ —É—á—ë—Ç–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤)" },
      { "key": "FACTOR_SANTA_COLD_HIGH", "type": "decimal", "default": 1.12, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä, –µ—Å–ª–∏ –≤–æ–∑—Ä–∞—Å—Ç > 75" },
      { "key": "FACTOR_SANTA_CHIMNEY_HIGH", "type": "decimal", "default": 1.10, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä, –µ—Å–ª–∏ –≤–µ—Å >120 –∏ —Ç–∞–ª–∏—è >150" },
      { "key": "FACTOR_SLED_MANUAL", "type": "decimal", "default": 1.15, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Å–∞–Ω–µ–π —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º" },
      { "key": "FACTOR_BAG_FABRIC", "type": "decimal", "default": 1.10, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Ç–∫–∞–Ω–µ–≤–æ–≥–æ –º–µ—à–∫–∞" },
      { "key": "FACTOR_ANY_FLAGS_REINDEER", "type": "decimal", "default": 1.08, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ª—é–±–æ–≥–æ —Ñ–ª–∞–≥–∞ –ø–æ –æ–ª–µ–Ω—è–º" },
      { "key": "FACTOR_ANY_FLAGS_ELVES", "type": "decimal", "default": 1.08, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ª—é–±–æ–≥–æ —Ñ–ª–∞–≥–∞ –ø–æ —ç–ª—å—Ñ–∞–º" },
      { "key": "FACTOR_ANY_FLAGS_PROD_BREAK", "type": "decimal", "default": 1.10, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ª—é–±–æ–≥–æ —Ñ–ª–∞–≥–∞ –ø–æ –ø–µ—Ä–µ—Ä—ã–≤—É" },
      { "key": "FACTOR_TPL_WHEREVER", "type": "decimal", "default": 1.12, "description": "–ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –ø–∞—Ä–∫–æ–≤–∫–µ '–≥–¥–µ –ø–æ–ª—É—á–∏—Ç—Å—è'" },
      { "key": "FACTOR_PER_RISK_UNIT", "type": "decimal", "default": 0.02, "description": "–ù–∞–¥–±–∞–≤–∫–∞ –∫ —Ç–∞—Ä–∏—Ñ—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É –≤–µ—Å–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤ (–∫—Ä–æ–º–µ —Ñ—Ä–∞–Ω—à–∏–∑—ã)" },
      { "key": "DEDUCTIBLE_DISCOUNT_MAX", "type": "decimal", "default": 0.08, "description": "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ –∑–∞ —Ñ—Ä–∞–Ω—à–∏–∑—É (–ø—Ä–∏ –≤–µ—Ä—Ö–Ω–µ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —Ñ—Ä–∞–Ω—à–∏–∑—ã)" }
    ],
    "tariff_formula": {
      "tariff_total_expr": "pricing.base_rate * pricing.multipliers_product * (1 + pricing.risk_weight_sum * pricing.factor_per_risk_unit) * (1 - pricing.deductible_discount)",
      "premium_total_expr": "round(answers.FLD_INSURED_SUM * pricing.tariff_total)",
      "rounding": { "premium_total": "int", "method": "round" }
    }
  },
  "rules": [
    {
      "rule_id": "R_VIS_SANTA",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_SANTA')",
      "then": [
        { "op": "set_visible", "field_id": "FLD_SANTA_AGE", "value": true },
        { "op": "set_visible", "field_id": "FLD_SANTA_WEIGHT", "value": true },
        { "op": "set_visible", "field_id": "FLD_SANTA_WAIST", "value": true }
      ],
      "else": [
        { "op": "set_visible", "field_id": "FLD_SANTA_AGE", "value": false },
        { "op": "set_visible", "field_id": "FLD_SANTA_WEIGHT", "value": false },
        { "op": "set_visible", "field_id": "FLD_SANTA_WAIST", "value": false }
      ]
    },
    {
      "rule_id": "R_VIS_SLED",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_SLED')",
      "then": [{ "op": "set_visible", "field_id": "FLD_SLED_TYPE", "value": true }],
      "else": [{ "op": "set_visible", "field_id": "FLD_SLED_TYPE", "value": false }]
    },
    {
      "rule_id": "R_VIS_BAG",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_BAG')",
      "then": [{ "op": "set_visible", "field_id": "FLD_BAG_TYPE", "value": true }],
      "else": [{ "op": "set_visible", "field_id": "FLD_BAG_TYPE", "value": false }]
    },
    {
      "rule_id": "R_VIS_REINDEER",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_REINDEER')",
      "then": [
        { "op": "set_visible", "field_id": "FLD_REINDEER_COUNT", "value": true },
        { "op": "set_visible", "field_id": "FLD_REINDEER_FLAGS", "value": true }
      ],
      "else": [
        { "op": "set_visible", "field_id": "FLD_REINDEER_COUNT", "value": false },
        { "op": "set_visible", "field_id": "FLD_REINDEER_FLAGS", "value": false }
      ]
    },
    {
      "rule_id": "R_VIS_ELVES",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ELVES')",
      "then": [
        { "op": "set_visible", "field_id": "FLD_ELVES_COUNT", "value": true },
        { "op": "set_visible", "field_id": "FLD_ELVES_FLAGS", "value": true }
      ],
      "else": [
        { "op": "set_visible", "field_id": "FLD_ELVES_COUNT", "value": false },
        { "op": "set_visible", "field_id": "FLD_ELVES_FLAGS", "value": false }
      ]
    },
    {
      "rule_id": "R_VIS_PROD_BREAK",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_PROD_BREAK')",
      "then": [{ "op": "set_visible", "field_id": "FLD_PROD_BREAK_FLAGS", "value": true }],
      "else": [{ "op": "set_visible", "field_id": "FLD_PROD_BREAK_FLAGS", "value": false }]
    },
    {
      "rule_id": "R_VIS_TPL",
      "type": "visibility",
      "when": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_TPL')",
      "then": [{ "op": "set_visible", "field_id": "FLD_TPL_PARKING", "value": true }],
      "else": [{ "op": "set_visible", "field_id": "FLD_TPL_PARKING", "value": false }]
    },

    {
      "rule_id": "R_VIS_RISKS_GATING",
      "type": "visibility",
      "when": "true",
      "then": [
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_SLED",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_SLED')"
        },
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_REINDEER",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_REINDEER')"
        },
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_BAG",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_BAG')"
        },
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_ELVES",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ELVES')"
        },
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_PROD_BREAK",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_PROD_BREAK')"
        },
        {
          "op": "set_visible",
          "field_id": "FLD_RISKS_TPL",
          "value_expr": "includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_ALL_RISKS') || includes(answers.FLD_OBJECTS_SELECTED, 'OBJ_TPL')"
        },
        { "op": "set_visible", "field_id": "FLD_RISKS_FORCE_MAJEURE", "value": true }
      ]
    },

    {
      "rule_id": "R_PRICE_ACCUMULATE",
      "type": "pricing",
      "when": "true",
      "then": [
        { "op": "pricing_reset" },

        { "op": "pricing_set", "key": "base_rate", "value_expr": "params.BASE_RATE" },
        { "op": "pricing_set", "key": "factor_per_risk_unit", "value_expr": "params.FACTOR_PER_RISK_UNIT" },

        {
          "op": "pricing_add_multiplier",
          "code": "SANTA_COLD_HIGH",
          "multiplier_expr": "computed.CMP_SANTA_COLD_RISK_LEVEL === 'HIGH' ? params.FACTOR_SANTA_COLD_HIGH : 1",
          "note_expr": "computed.CMP_SANTA_COLD_RISK_LEVEL === 'HIGH' ? '–í–æ–∑—Ä–∞—Å—Ç > 75: –ø–æ–≤—ã—à–µ–Ω —Ä–∏—Å–∫ –ø—Ä–æ—Å—Ç—É–¥–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π' : null"
        },
        {
          "op": "pricing_add_multiplier",
          "code": "SANTA_CHIMNEY_HIGH",
          "multiplier_expr": "computed.CMP_SANTA_CHIMNEY_STUCK_RISK === 'HIGH' ? params.FACTOR_SANTA_CHIMNEY_HIGH : 1",
          "note_expr": "computed.CMP_SANTA_CHIMNEY_STUCK_RISK === 'HIGH' ? '–í–µ—Å >120 –∏ —Ç–∞–ª–∏—è >150: –ø–æ–≤—ã—à–µ–Ω —Ä–∏—Å–∫ –∑–∞—Å—Ç—Ä–µ–≤–∞–Ω–∏—è –≤ –¥—ã–º–æ—Ö–æ–¥–µ' : null"
        },

        {
          "op": "pricing_add_multiplier",
          "code": "SLED_MANUAL",
          "multiplier_expr": "answers.FLD_SLED_TYPE === 'SLED_MANUAL' ? params.FACTOR_SLED_MANUAL : 1",
          "note_expr": "answers.FLD_SLED_TYPE === 'SLED_MANUAL' ? '–°–∞–Ω–∏ —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º: –ø–æ–≤—ã—à–∞—é—â–∏–π —Ç–∞—Ä–∏—Ñ' : null"
        },
        {
          "op": "pricing_add_multiplier",
          "code": "BAG_FABRIC",
          "multiplier_expr": "answers.FLD_BAG_TYPE === 'BAG_FABRIC' ? params.FACTOR_BAG_FABRIC : 1",
          "note_expr": "answers.FLD_BAG_TYPE === 'BAG_FABRIC' ? '–¢–∫–∞–Ω–µ–≤—ã–π –º–µ—à–æ–∫: –ø–æ–≤—ã—à–∞—é—â–∏–π —Ç–∞—Ä–∏—Ñ' : null"
        },

        {
          "op": "pricing_add_multiplier",
          "code": "REINDEER_FLAGS",
          "multiplier_expr": "computed.CMP_ANY_REINDEER_FLAGS ? params.FACTOR_ANY_FLAGS_REINDEER : 1",
          "note_expr": "computed.CMP_ANY_REINDEER_FLAGS ? '–û–ª–µ–Ω–∏: –≤—ã–±—Ä–∞–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä' : null"
        },
        {
          "op": "pricing_add_multiplier",
          "code": "ELVES_FLAGS",
          "multiplier_expr": "computed.CMP_ANY_ELVES_FLAGS ? params.FACTOR_ANY_FLAGS_ELVES : 1",
          "note_expr": "computed.CMP_ANY_ELVES_FLAGS ? '–≠–ª—å—Ñ—ã: –≤—ã–±—Ä–∞–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–æ–ø. –ø–∞—Ä–∞–º–µ—Ç—Ä' : null"
        },
        {
          "op": "pricing_add_multiplier",
          "code": "PROD_BREAK_FLAGS",
          "multiplier_expr": "computed.CMP_ANY_PROD_BREAK_FLAGS ? params.FACTOR_ANY_FLAGS_PROD_BREAK : 1",
          "note_expr": "computed.CMP_ANY_PROD_BREAK_FLAGS ? '–ü–µ—Ä–µ—Ä—ã–≤ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ: –≤—ã–±—Ä–∞–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–∫—Ç–æ—Ä' : null"
        },
        {
          "op": "pricing_add_multiplier",
          "code": "TPL_WHEREVER",
          "multiplier_expr": "computed.CMP_TPL_WHEREVER_SELECTED ? params.FACTOR_TPL_WHEREVER : 1",
          "note_expr": "computed.CMP_TPL_WHEREVER_SELECTED ? '–ü–∞—Ä–∫–æ–≤–∫–∞: –≥–¥–µ –ø–æ–ª—É—á–∏—Ç—Å—è (–ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫)' : null"
        },

        {
          "op": "pricing_set",
          "key": "risk_weight_sum",
          "value_expr": "sumRiskWeights(coalesce(answers.FLD_RISKS_SLED,[]),coalesce(answers.FLD_RISKS_REINDEER,[]),coalesce(answers.FLD_RISKS_BAG,[]),coalesce(answers.FLD_RISKS_ELVES,[]),coalesce(answers.FLD_RISKS_PROD_BREAK,[]),coalesce(answers.FLD_RISKS_TPL,[]),coalesce(answers.FLD_RISKS_FORCE_MAJEURE,[]))"
        },

        {
          "op": "pricing_set",
          "key": "deductible_discount",
          "value_expr": "coalesce(answers.FLD_DEDUCTIBLE,0) <= 0 ? 0 : Math.min(params.DEDUCTIBLE_DISCOUNT_MAX, (coalesce(answers.FLD_DEDUCTIBLE,0) / 500000) * params.DEDUCTIBLE_DISCOUNT_MAX)"
        },

        {
          "op": "pricing_compute",
          "outputs": [
            { "target_field_id": "FLD_TARIFF_TOTAL", "value_expr": "computeTariffTotal()" },
            { "target_field_id": "FLD_PREMIUM_TOTAL", "value_expr": "computePremiumTotal()" },
            { "target_field_id": "FLD_TARIFF_BREAKDOWN", "value_expr": "computeBreakdown()" }
          ],
          "persist": [
            { "table": "policy", "column": "tariff_total", "value_expr": "computeTariffTotal()" },
            { "table": "policy", "column": "premium_total", "value_expr": "computePremiumTotal()" }
          ]
        }
      ]
    }
  ],
  "extensions": {
    "pricing_helpers_spec": {
      "sumRiskWeights": {
        "inputs": "arrays of risk_ids",
        "logic": "lookup each risk_id in DICT_RISKS.items and sum item.weight"
      },
      "computeTariffTotal": {
        "logic": "BASE_RATE * multipliers_product * (1 + risk_weight_sum * FACTOR_PER_RISK_UNIT) * (1 - deductible_discount)"
      },
      "computePremiumTotal": {
        "logic": "round(insured_sum * tariff_total)"
      },
      "computeBreakdown": {
        "logic": "return an object with base_rate, multipliers (codes, values, notes), risk_weight_sum, factor_per_risk_unit, deductible_discount, tariff_total, premium_total"
      }
    }
  }
}
